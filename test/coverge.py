# encoding:utf-8


import json
import os

import jieba
import openai

content_file = "/Users/zhanglin/Desktop/LM_as_Evaluator/data/taxonomy/history_qa_v1.json"
content = json.load(open(content_file, 'r', encoding='utf-8'))




def Jaccrad(model, reference):  # terms_reference为源句子，terms_model为候选句子
    terms_reference = jieba.cut(reference)  # 默认精准模式
    terms_model = jieba.cut(model)
    grams_reference = set(terms_reference)  # 去重；如果不需要就改为list
    grams_model = set(terms_model)
    temp = 0
    for i in grams_reference:
        if i in grams_model:
            temp = temp + 1
    fenmu = len(grams_model) + len(grams_reference) - temp  # 并集
    jaccard_coefficient = float(temp / fenmu)  # 交集
    return jaccard_coefficient


# b = "殖民主义形成的原因是多方面的，包括经济、政治、文化和技术等诸多因素。以下是一些主要原因：\n\n经济原因：随着资本主义的发展，欧洲列强为了寻求原材料、市场和投资机会，以满足日益增长的经济需求，开始拓展势力范围，控制殖民地。\n政治原因：欧洲国家在近代为了竞争国际地位，提高国家声望，开始争夺海外殖民地，彰显自己的政治实力。\n文化原因：在宗教和文化方面，欧洲国家试图传播基督教，希望通过改变殖民地的宗教信仰来巩固自己的统治，同时也视之为\"文明使命\"。\n技术原因：航海技术、武器装备和医学的进步，使得欧洲列强能够迅速地开疆拓土，占领并统治远离本土的地区。\n殖民主义对世界历史产生了深远影响，如下所述：\n\n地理大发现：欧洲列强在争夺殖民地的过程中，探索了一系列新的航线，发现了新大陆，世界地图被重新绘制。\n国际贸易的发展：奴隶制、三角贸易以及其他互动的贸易发展，导致贫富差距日益扩大。\n文化交流与冲突：欧洲殖民者将自己的文化和信仰传播到殖民地，原住民文化发生严重被侵蚀和破坏。但与此同时，东西方文化的交流，导致人类历史上的重大发展和变革。\n种族歧视和奴隶制：这是殖民主义的黑暗面，奴隶制导致大量非洲人在极其恶劣的条件下劳动和生活，而种族歧视则导致非洲、亚洲等地区的革命斗争。\n殖民地的独立运动：殖民地国家百年来的抗议、反抗殖民势力的压迫与剥削，推动了民主和独立思想的传播和民族意识的觉醒，促进了后来的独立运动和民族解放事业。\n世界格局的演变：随着殖民地的获得，世界格局发生了巨大变化，大国之间权力的不断重新洗牌，导致两次世界大战的爆发。同时，二战后，大量殖民地纷纷脱离殖民统治，寻求独立和自主，世界进入新的历史时期。\n\n"
# b = "马克思主义的诞生与传播 1844年6月4日，德意志西里西亚纺织工人高唱革命 歌曲，举行游行示威，示威活动很快发展为起义。起义工人 捣毁工厂，焚烧债券，队伍很快发展到3000多人，后来起 义被镇压。这幅图反映的是统治者镇压工人起义的情景。 ▲在英国煤矿中工作的童工（绘画作品） ▲统治者派兵镇压西里西亚织工起义 （绘画作品） 工人阶级的悲惨遭遇引发 了早期工人运动，“空想社会 主义”没有找到解决资本主义 矛盾的正确途径。 学习聚焦 早期工人运动与社会主义思想的萌发 随着资本主义大工业的建立和发展，资本主义制度 的各种弊病逐渐显现。1825年，英国爆发了经济危机。此 后，每隔十年左右就会爆发一次资本主义经济危机。虽然 生产力不断提高、劳动产品日益丰富，但工人阶级的生活 条件并没有得到相应改善，他们的政治权利也极其有限。 在工业化的早期阶段，欧洲各地普遍出现了贫富分化严重、 工人阶级苦难深重的状况。 当时工人的劳动条件相当恶劣，厂房狭小简陋，被污 染的空气几乎使人窒息，工伤事故频频发生。工人尽管每 天工作长达十几个小时，但工资微薄，并时时面临失业的 威胁。大机器的采用也把妇女和儿童卷进劳动力市场，他 们的境况更为悲惨。工人的住宅区是大城市和工业区的贫 民窟，街道狭窄拥挤，房屋低矮破旧，天空浓烟密布，地 下污水横流，成了贫穷、疾病和犯罪之地。  为了改善劳动条件和生活状况，维护 自己的权益，工人阶级进行了从捣毁机器到 争取政治权利的多种形式的斗争。19世纪 三四十年代爆发的法国里昂工人武装起义、 英国工人争取普选权的宪章运动和德意志西 里西亚织工起义，表明工人阶级开始作为独 立的政治力量登上历史舞台。工人阶级迫切 需要科学理论的指导。 在工人阶级进行斗争的同时，以法国 人圣西门、傅立叶和英国人欧文为代表的有 识之士，也无情地揭露和批判资本主义制度 的种种弊端。他们反对自由放任的竞争，主 张建立合作、平等、和谐的理想社会。但 是，他们没有找到实现理想社会的现实力量 和正确有效的途径，他们的设想被称为“空 想社会主义”。 ▲“新和谐公社”蓝图 1824年，欧文在美国印第安纳州购买了120多平方千米的土地建设一 个名为“新和谐公社”的社会组织，进行共产主义“劳动公社”的试验。 这里有工厂、农场和学校，每个人都参加劳动，分工合作，人人享有充分 的、平等的民主权利。但是，“新和谐公社”脱离社会现实，最终内部矛盾 激化，4年后失败。 ▲宪章运动（绘画作品） 1836年，伦敦工人协会成立。后来，协会拟定 了呈送议会要求普选权的请愿书，并以“人民宪章” 名义正式公布，得到全国响应，这是宪章运动开始 的标志。宪章运动持续时间超过10年，数次向议会 递交请愿书，几百万工人先后在请愿书上签名，大 大激发了工人的斗争热情。 马克思和恩格斯经过长 期的理论探索和革命实践， 创立了马克思主义，为国际 工人运动指明了正确方向。 学习聚焦 马克思主义的诞生 19世纪中叶，德国思想家、革命家马克思和恩格斯在 广泛吸收人类优秀思想成果的基础上，进一步探讨工业革命 引起的社会变化，总结工人运动的经验，共同创立了富有生 命力的马克思主义。  1846—1847年间，马克思和恩格斯先后在布鲁塞尔建 立了共产主义通讯委员会和德意志工人协会，还加入了德 意志流亡工人的组织“正义者同盟”，并帮助该同盟改组 为“共产主义者同盟”。在伦敦召开的共产主义者同盟第 二次代表大会上，马克思和恩格斯受大会委托起草同盟纲 领，这就是1848年2月发表的《共产党宣言》。 ▲马克思（1818—1883） ▲恩格斯（1820—1895） 《共产党宣言》肯定了资本主义的历史进步作用，指 出“资产阶级在它的不到一百年的阶级统治中所创造的生 产力，比过去一切世代创造的全部生产力还要多，还要 大”。《共产党宣言》揭示了资本主义在积累财富和资本的 同时对工人阶级的残酷剥夺必将引起工人阶级反抗的社会 现实，论证了资本主义必然灭亡、共产主义必然胜利的客 观规律。《共产党宣言》肯定阶级斗争在阶级社会中推动历 史发展的重要作用，宣告了无产阶级作为资本主义掘墓人 和共产主义建设者的伟大使命，阐明了共产党的性质、目 的和策略原则。 《共产党宣言》第一次较为完整系统地阐述了科学社 会主义的基本原理，阐明了社会发展的客观规律，标志着 马克思主义的诞生。 1848年，欧洲普遍发生革命，马克思和恩格斯回到德 国，投入实际的革命斗争。他们创办报纸宣传革命，组织 工人参加武装起义。革命失败后，他们主要在英国活动， 在指导工人阶级进行斗争的同时，继续进行理论探索。 1867年，马克思撰写的政治经济学巨著《资本论》第 一卷出版。通过对资本主义制度的深刻剖析，马克思创立了 随着大工业的发展，资 产阶级赖以生产和占有产品的 基础本身也就从它的脚下被 挖掉了。它首先生产的是它自 身的掘墓人。资产阶级的灭 亡和无产阶级的胜利是同样 不可避免的。 ——［德］马克思、［德］ 恩格斯《共产党宣言》，《马克 思恩格斯文集》第二卷 史料阅读 1848年革命 19世纪40年代，在欧 洲大陆，西欧各国的资产 阶级迫切要求争取更多的 政治权利，东南欧国家的 人民希望结束外国统治， 获得民族独立，革命一触 即发。1848年1月，意大利 首先爆发革命，掀开了欧 洲革命的序幕。2月，巴黎 发生武装起义，推翻了七 月王朝，再次建立了共和 国，把1848年革命推向高 潮。革命席卷了欧洲许多 地区，沉重地打击了欧洲 的封建势力，有利于资本 主义的进一步发展。在这 场革命中，无产阶级发挥 了重要作用。 历史纵横 马克思和恩格斯在《共 产党宣言》中表达了怎样的 思想？ 思考点  剩余价值学说，揭露了资本主义制度和资本家剥削的秘密。 《资本论》成为马克思主义理论最重要的文献之一。 马克思和恩格斯创立了唯物史观。唯物史观科学地揭 示了生产力与生产关系、经济基础与上层建筑在人类社会 发展中的辩证关系，鲜明地提出了人民群众对历史发展的 巨大作用。 马克思主义是科学的、人民的、实践的、不断发展的 开放的理论，它创造性地揭示了人类社会发展规律，第一 次创立了人民实现自身解放的思想体系，指引着人民改造 世界的行动，始终站在时代前沿。 自19世纪中期起，马克思主义成为西欧工人运动的指 导思想；在东欧和东南欧，马克思主义的影响日益扩大； 在亚洲和美洲，马克思主义是工人运动与民族民主运动的 重要思想武器。 在马克思主义影响下，马克思主义政党在世界范围内 如雨后春笋般建立和发展起来，人民第一次成为自己命运 的主人，成为实现自身解放和全人类解放的根本政治力量。 国际工人运动的发展 在《共产党宣言》中，马克思和恩格斯发出了“全 世界无产者，联合起来”的伟大号召，积极促进工人阶级 的国际联合。1864年，国际工人协会在伦敦成立，这就是 历史上的“第一国际”。马克思是第一国际的创始人之一。 第一国际的成立推动了马克思主义的传播和国际工人运动 进入新阶段。 1870年，法国在普法战争中失败，社会矛盾激化。 1871年3月，巴黎爆发工人武装起义，起义者建立了自己 的政权—巴黎公社。第一国际的一些成员在公社的活动 中发挥了重要作用，他们认为建立工人政权是向社会主义 迈出的第一步。 ▲1871年3月28日，巴黎公社宣告成立（绘画作品） 剩余价值论 马克思在《资本论》 中深刻分析了资本家剥削 工人的秘密。他指出，工 人的工资在整个工业生产 产生的利润中所占的比重 很小，工人只要在每个工 作日劳动很少一部分时间， 就足以抵偿这点工资；在 余下的大部分时间里，工 人都是在无偿地为资本家 工作，他们创造的价值也 全部为资本家所得。这就 是资本家日益富裕的秘密。 资本家从生产中获得的利 润被称为“剩余价值”。马 克思的这一理论被称为 “剩余价值论”。 历史纵横 巴黎公社的实践丰富了 马克思主义的学说，为无产 阶级革命留下了重要启示。 学习聚焦  巴黎公社采取了一系列革命措施：打碎旧的国家机 器，建立立法与行政合一的政权机关和司法机构；废除旧 军队和旧警察，代之以国民自卫军和治安委员会；人民有 权监督和罢免由选举产生的公职人员，所有公职人员的工 资不得超过熟练工人的工资；由工人合作社管理工厂；实 行八小时工作日；等等。 ▲ 巴黎公社社员墙 1871年5月27日，200名巴黎 公社战士浴血奋战，最后一批公社 战士被敌人围困在一堵墙边，最后 全部壮烈牺牲。这堵墙被命名为 “巴黎公社社员墙”。 公社的伟大社会措施就是它本身的存在和工作。它所采取 的各项具体措施，只能显示出走向属于人民、由人民掌权的政 府的趋势…… ………… 工人的巴黎及其公社将永远作为新社会的光辉先驱而为人 所称颂。 ——［德］马克思《法兰西内战》，《马克思恩格斯文集》 第三卷 谈谈你对这段话的理解。 学思之窗 1871年5月28日，巴黎公社被法国资产阶级和德国联 合扼杀。但是，巴黎公社作为无产阶级建立政权的第一次 伟大尝试被载入史册，它的实践丰富了马克思主义的学说， 为国际工人运动的发展提供了宝贵的经验和教训。  探究与拓展 正像达尔文发现有机界的发展规律一样，马克思发现 了人类历史的发展规律，即历来为繁芜丛杂的意识形态所 掩盖着的一个简单事实：人们首先必须吃、喝、住、穿， 然后才能从事政治、科学、艺术、宗教等等；所以，直接 的物质的生活资料的生产，从而一个民族或一个时代的一 定的经济发展阶段，便构成基础，人们的国家设施、法的 观点、艺术以至宗教观念，就是从这个基础上发展起来的， 因而，也必须由这个基础来解释…… ——［德］恩格斯《在马克思墓前的讲话》，《马克思 恩格斯文集》第三卷 概括上述材料的主要观点，并谈谈你对这个观点的 理解。 问题探究 德国古典哲学是马克思主义的来源之一。查找资 料，进一步了解马克思主义哲学对德国古典哲学的继承 和超越。 学习拓展  第六单元 世界殖民体系与亚非拉民族独立运动 随着新航路的开辟，西欧国家率先踏上了对外殖民扩 张的道路。18世纪，拉丁美洲已经完全处于欧洲列强的殖 民统治之下。随着工业革命的深化和资本主义的不断发展， 欧洲列强的海外殖民活动愈演愈烈。19世纪中后期，伴随 第二次工业革命浪潮，资本主义开始向帝国主义过渡，西 方列强掀起了瓜分世界的狂潮，把亚洲和非洲的广大地区 变成了它们的殖民地或半殖民地。到20世纪初，资本主义 列强已经奴役和控制了世界上绝大部分土地和人口，建立 了资本主义世界殖民体系，形成了人类历史上由少数资本 主义国家奴役和控制世界上绝大多数国家和地区的极不合 理的状态。资本主义列强与殖民地半殖民地的矛盾空前激 化，殖民地半殖民地人民争取民族独立的斗争不断高涨。 通过本单元的学习，了解西方列强建立世界殖民体系 的过程，以及亚非拉人民的抗争，理解殖民地半殖民地的 民族独立运动对世界历史发展的重要影响。  第12课"
#
# jaccard_coefficient = Jaccrad(a, b)
# print(jaccard_coefficient)

b = "五四运动是20世纪初中国一场以爱国主义和民主科学思想为主要内容的政治、文化和社会运动。它对中国革命和现代化进程产生了深远的影响，并推动了中国社会历史的进步。五四运动的影响主要体现在以下几个方面：\n\n" \
    "激发民族觉醒：五四运动极大地激发了中国人民的民族自尊心和民族自信心。在运动中，爱国主义情怀得到前所未有的强烈表达，中国人民开始认识到民族复兴的重要性，民族觉悟得到空前的提高。\n" \
    "引领新思想：五四运动中，民主、科学、实事求是等新思想得到广泛传播，对中国传统封建思想体系产生了强烈冲击。许多青年知识分子和社会各界人士通过新文化运动吸收和传播西方现代文化思想，对中国的社会观念、价值观和文化风尚产生重要影响。" \
    "\n生发新文化：五四运动使中国进入了新文化时代。民主、科学、自由等观念成为新时期的主流价值观。旧文化的瓦解和新文化的确立使中国传统文化发生深刻变革。现代文学、艺术、教育、科技等领域得到迅速发展，推动了整个国家现代化和社会进步。" \
    "\n催生新政治：五四运动导致了中国政治格局的重大变革。在五四运动的影响下，中国共产党应运而生，开始了中国新民主主义革命的历程。通过一系列斗争，中国共产党最后取得成功，建立了新中国，为中国引入了社会主义制度，为实现民族独立和社会发展打下了坚实基础。" \
    "\n催生新经济：五四运动发扬民主和科学的精神，为中国经济现代化建立了理论体系和实践土壤。五四思想家倡导创新和实践，大力发展国民经济，为民生改革和现代化建设注入源源不断的动力，推动中国经济不断前进。" \
    "\n引导新外交：五四运动对中国的外交事业产生了重大影响。五四运动之后，中国开始摆脱不平等条约的桎梏，倡导主权独立和民族平等。新中国成立后，持续与世界无产者大联合，树立新的国际形象，赢得世界广泛尊重。" \
    "\n总之，五四运动的深远影响从各个方面推动了中国社会历史的进步，成为了近现代中国发展历程中具有划时代意义的重要事件。"

############################
# Jaccard
############################
# for c in content:
#     for chapter in c:
#         for k1 in c[chapter]:
#             print(k1)
#             for k2 in c[chapter][k1]:
#                 print(c[chapter][k1][k2]["text"].split(" ")[1])
#                 jaccard_coefficient = Jaccrad(c[chapter][k1][k2]["text"], b)
#                 print(jaccard_coefficient)

############################
# API(gpt-3.5)
############################
os.environ["OPENAI_API_KEY"] = "33e8f0c860bc4109825496444bbfed3e"
openai.api_type = "azure"
openai.api_base = "https://community-openai-34.openai.azure.com/"
openai.api_version = "2023-03-15-preview"
openai.api_key = os.getenv("OPENAI_API_KEY")
for c in content:
    for chapter in c:
        for k1 in c[chapter]:
            # print(k1)
            for k2 in c[chapter][k1]:
                inputs = "文本1: " + b + "\n" + "文本2: " + c[chapter][k1][k2]["text"] + "\n" + "请给出分数。"
                response = openai.ChatCompletion.create(
                        engine="gpt35-34",
                        messages=[
                            {"role": "system",
                             "content": "你现在是一个内容比较器，你需要根据判断文本1包含了文本2多少内容，用1-100分数表示"},
                            {"role": "user", "content": inputs},
                        ],
                        temperature=0.95,
                        max_tokens=800,
                        top_p=0.95,
                        n=5,
                        frequency_penalty=0,
                        presence_penalty=0,
                        stop=None)
                scores = \
                            [response["choices"][0]["message"]["content"],
                         response["choices"][1]["message"]["content"],
                         response["choices"][2]["message"]["content"],
                         response["choices"][3]["message"]["content"],
                         response["choices"][4]["message"]["content"]]

                print(k2)
                print(scores)
